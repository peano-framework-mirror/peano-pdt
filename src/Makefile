# This is a makefile for Peano's StorageSchemes component
# generated by the Peano Development Tools (PDT) 

# Include files
-include files.mk



OBJECTS=$(SOURCES:.java=.class)


default: 
	@echo Peano Development Toolkit \(pdt\)
	@echo -------------------------------
	@echo 
	@echo Supported targets then are
	@echo   clean
	@echo   createParser
	@echo   compile
	@echo   dist
	@echo   all


clean:
	rm -f $(OBJECTS)
	rm -f files.mk
	rm -rf ../bin
	rm -rf org/peano/pdt/analysis
	rm -rf org/peano/pdt/lexer
	rm -rf org/peano/pdt/node
	rm -rf org/peano/pdt/parser
	rm -rf de


createParser:
	java -jar ../lib/sablecc.jar -d . ../pdt.grammar 
	tar -xzvf ../lib/DaStGen.tar.gz de
	rm -f files.mk

prepare:
	mkdir -p ../bin

compile: prepare files.mk $(OBJECTS) 


dist:
	tar -czf ../pdt.tar.gz MANIFEST.MF Makefile ../pdt.grammar org
	jar -xf ../lib/jargs.jar
	rm -rf ../bin/jargs
	rm -rf ../bin/META-INF
	mv -f jargs ../bin
	mv -f META-INF ../bin
	mkdir ../bin/stdtemplates
	cp -r ../stdtemplates/* ../bin/stdtemplates
	cp org/peano/pdt/parser/parser.dat ../bin/org/peano/pdt/parser
	cp org/peano/pdt/lexer/lexer.dat ../bin/org/peano/pdt/lexer
	cp de/tum/in/dast/lexer/lexer.dat  ../bin/de/tum/in/dast/lexer
	cp de/tum/in/dast/parser/parser.dat  ../bin/de/tum/in/dast/parser
	cp de/tum/in/dast/properties/*.properties  ../bin/de/tum/in/dast/properties
	jar cmf MANIFEST.MF ../pdt.jar -C ../bin .
	


all: clean createParser compile dist


files.mk:
	@touch files.mk
	@echo "SOURCES=\\" > files.mk
	find . -name '*.java' | tr '\n' ' ' >> files.mk



$(OBJECTS): %.class : %.java
	javac -classpath ../lib/jargs.jar -sourcepath . -d ../bin $<  


